---
title: "Code Scratch"
author: "Alicia Rich"
date: "`r Sys.Date()`"
output: html_document
                     
---

```{r setup, include=FALSE}
library(conflicted)
library(devtools)
library(DiagrammeR)
library(here)
library(igraph)
library(knitr)
library(magrittr)
library(pedtools)
library(roxygen2)
library(tidyverse)
library(visNetwork)
knitr::opts_chunk$set(
  collapse = TRUE,
  message  = FALSE,
  warning  = FALSE,
  echo     = TRUE,
  include  = TRUE,
  eval     = TRUE,
  comment  = ""
)
conflicts_prefer(lubridate::interval)
conflicts_prefer(dplyr::filter)
conflicts_prefer(purrr::set_names)
studbook <- read_csv(here("inst/extdata/studbook.csv"))
pedigree <- featured_pedigree(studbook)
```

```{r}
subnucs <- ped_subnucs(pedigree)
```

```{r}
subnuc_test <- subnucs(pedigree) %>% 
  map_depth(., 1, \(x) unclass(x)) %>%
  map(\(x) enframe(x, name = "type", value = "id")) %>%
  map_depth(1, \(x) unnest_longer(x, id)) %>%
  map_depth(1, \(x) mutate(x, 
                           type = case_match(type, 
                             "mother" ~"mom", 
                             "father" ~"dad",
                             .default = type)))
```

```{r}
nodes_test <- subnucs_nodes(subnuc_test, studbook, pedigree)
```

```{r}
subnucs_test <- subnucs_nested(pedigree = pedigree)
```

```{r}
edges <- map_depth(subnucs_test, 1, \(x) subnucs_edges(x))
```

```{r}
nodes <- map_depth(subnucs_test, 1, \(x) subnucs_nodes(x, studbook, pedigree))
```


```{r}
subnuc_nodes <- subnuc_test %>%
  mutate(connect_parents  = 1,
         connect_children = 2) %>%
  pivot_longer(
    everything(),
    names_to  = "type",
    values_to = "id"
  ) %>%
  mutate(id = as.numeric(id)) %>%
  distinct() %>%
  arrange(id)
```


