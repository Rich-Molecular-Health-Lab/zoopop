---
title: "Code Scratch"
author: "Alicia Rich"
date: "`r Sys.Date()`"
output: html_document
                     
---

```{r setup, include=FALSE}
library(devtools)
library(roxygen2)
```


```{r include=FALSE}
document()
install()
```


```{r include=FALSE}
library(conflicted)
library(devtools)
library(DiagrammeR)
library(here)
library(igraph)
library(knitr)
library(magrittr)
library(pedtools)
library(roxygen2)
library(tidyverse)
library(visNetwork)
knitr::opts_chunk$set(
  collapse = TRUE,
  message  = FALSE,
  warning  = FALSE,
  echo     = TRUE,
  include  = TRUE,
  eval     = TRUE,
  comment  = ""
)
conflicts_prefer(lubridate::interval)
conflicts_prefer(dplyr::filter)
conflicts_prefer(purrr::set_names)
studbook <- read_csv(here("inst/extdata/studbook.csv"))
pedigree <- featured_pedigree(studbook)
```

```{r}
subnucs <- subnucs_nested(pedigree)
```

```{r}
nodes <- map_nodes_2dgm(studbook, pedigree)
```

```{r}
edges_test <- map_subnucs_edges(pedigree)
```

```{r}
data <- subnucs_dgm_data(studbook, pedigree)
```

```{r}
graphs <- diagrammeSubnucs(studbook, pedigree)
```

```{r}
map_depth(graphs, 1, \(x) print(x))
```

```{r}
merged <- merge_subnucs(studbook, pedigree)
```

```{r}
render_graph(merged, layout = "tree")
```


```{r}
edges <- map_subnucs_edges(pedigree)
```

```{r}
edges <- map_subnucs_edges(pedigree)

```


```{r}
peels <-  peelingOrder(pedigree) %>%
    map_depth(., 1, \(x) unclass(x)) %>%
    map(\(x) enframe(x, name = "type", value = "id")) %>%
    map_depth(1, \(x) unnest_longer(x, id)) %>%
    map_depth(1, \(x) mutate(x,
                             type = case_match(type,
                                               "mother"   ~"mom",
                                               "father"   ~"dad",
                                               "children" ~"kid",
                                               .default = type)))

```

```{r}
links <- peelingOrder(pedigree) %>%
 map_depth(., 1, \(x) keep_at(x, "link")) %>%
  list_flatten() %>%
  set_names() %>%
  map(., \(x) children(pedigree, x, internal = TRUE)) %>%
  enframe(name = "parent", value = "kid") %>%
  unnest_longer(kid)
```

```{r}
subnucD3 <- subnucs_D3(studbook, pedigree)
```

```{r}
map_depth(subnucD3, 1, \(x) print(x))
```

